
## 项目简介

这是一个中文手机号码营销海报自动生成器，可以从Excel表格中提取"吉祥号码"，按分类生成精美的营销海报（JPG格式）。系统支持AI文案生成、Web界面操作，以及**自动发送到微信公众号或企业微信**。

## ✨ 新功能：微信自动发送

**每天中午12点和晚上6点**，系统会自动生成海报并发送到微信!

- 🚀 支持**微信公众号**自动创建草稿
- 🚀 支持**企业微信**直接发送图片消息
- ⏰ 定时任务自动化发送
- 📝 详细配置文档: [微信发送使用指南.md](微信发送使用指南.md)

### 快速启用微信发送

1. 复制配置文件: `copy wechat_config.example.json wechat_config.json`
2. 编辑 `wechat_config.json`，填入你的微信API密钥
3. 运行: `python main.py --schedule` (启动定时任务)

**就这么简单!** 详细步骤请查看[微信发送使用指南.md](微信发送使用指南.md)

## 💡 小白用户使用指南

### 第一次使用（一键启动）

1. **准备数据**：
   - 确保项目根目录有 `吉祥号码.xlsx` 文件
   - Excel文件必须包含列：`号码`、`预存`、`低消`、`分类说明`

2. **启动Web界面**：
   - 双击 `start_web.bat` 文件
   - 或者打开命令行，输入：
     ```
     cd C:\Users\13507\Desktop\luck
     python web_app.py
     ```

3. **打开浏览器**：
   - 地址栏输入：`http://127.0.0.1:5000`
   - 即可看到海报生成界面

### 如何生成海报

1. **选择分类**：
   - 点击"随机选择分类"（推荐）
   - 或选择具体的号码分类（如"尾号双重"、"中间任意数字"等）

2. **生成海报**：
   - 点击"🎨 生成海报"按钮
   - 等待几秒钟，系统会自动生成海报

3. **下载海报**：
   - 在"生成的海报"区域查看所有文件
   - 点击"📥 下载"按钮保存到电脑

### 常见问题

**Q: 为什么生成失败？**
A: 可能是某个分类的可用号码不足9个，请选择其他分类或使用随机选择。

**Q: 如何修改海报样式？**
A: 海报样式在 `app/poster_generator_v2.py` 文件中，可以调整颜色、字体、布局等。

**Q: 如何添加新的号码数据？**
A: 直接编辑 `吉祥号码.xlsx` 文件，保持列名格式不变。

## 🛠 开发者命令

### 环境准备
```bash
# 安装所有依赖（包含Web界面）
pip install -r requirements.txt
```

### 命令行使用
```bash
# 立即生成一张海报（随机分类）
python main.py --once

# 生成海报并发送到微信
python main.py --once --send

# 指定分类生成海报
python main.py --once --category "尾号双重"

# 调试模式（显示选中的号码）
python main.py --once --debug

# 查看所有分类和可用数量
python main.py --list-categories

# 使用自定义Excel文件
python main.py --once --excel path/to/custom.xlsx

# 启动定时任务（12点和18点自动发送到微信）
python main.py --schedule
```

### Web界面启动
```bash
# 启动Web服务器
python web_app.py

# 访问地址：http://127.0.0.1:5000
```

## 🏗 项目架构

### 核心组件
- `main.py`: 命令行入口，支持单次生成和定时任务
- `web_app.py`: Web界面服务器（Flask）
- `app/config.py`: 中央配置文件，包含分类优先级和定时计划
- `app/data_loader.py`: Excel文件解析器
- `app/used_storage.py`: 已使用号码的JSON存储
- `app/selection.py`: 号码选择算法（按分类）
- `app/poster_generator_v2.py`: 主要海报渲染引擎（3×3布局）
- `app/ai_copy.py`: OpenAI文案生成集成
- `app/holidays_util.py`: 日期格式化和节日检测
- `app/wechat_sender.py`: **微信自动发送模块（新增）**

### 数据流程
1. 从Excel读取号码数据（列：号码、预存、低消、分类说明）
2. 根据分类优先级过滤未使用号码
3. 从选定分类中随机选择9个号码（3×3网格）
4. 生成AI营销文案或使用默认中文文案
5. 使用程序化背景渲染海报（无需模板图片）
6. 在JSON存储中标记已使用号码
7. **（可选）自动发送到微信公众号或企业微信**

### 配置说明
- **分类优先级**: "尾号双重"、"中间任意数字"、"*AABB"、"*ABC"等
- **定时计划**:
  - 09:00: 生成海报（不发送）
  - **12:00: 生成海报 + 自动发送到微信** ✅
  - **18:00: 生成海报 + 自动发送到微信** ✅
- **输出格式**: `output/YYYYMMDD_HHMM.jpg`
- **品牌标识**: "南昌县移动专供"，归属地"南昌"
- **微信发送**: 配置 `wechat_config.json` 启用自动发送

### 字体处理
优先级回退系统：
1. 项目根目录的 `msyh.ttc`（微软雅黑）
2. Windows系统字体 `C:\Windows\Fonts\msyh.ttc`
3. 项目根目录的 `arial.ttf`
4. PIL默认字体

### AI集成
- **可选OpenAI API**（设置 `OPENAI_API_KEY` 环境变量）
- **模型**: `gpt-4o-mini`（可配置）
- **回退机制**: API不可用时使用本地中文营销文案

## 📋 数据要求

### Excel文件结构 (`吉祥号码.xlsx`)
- `号码`: 手机号码（字符串/数字）
- `预存`: 预存金额（数字）
- `低消`: 最低消费（数字）
- `分类说明`: 分类名称（字符串）

### 使用记录
`used_numbers.json` 文件追踪使用历史，防止号码重复使用。

## 🎨 界面特色

Web界面提供：
- 📱 可视化分类选择（显示可用号码数量）
- 🎲 随机分类生成选项
- ⚡ 实时生成状态显示
- 📁 文件管理和下载功能
- 🎯 响应式设计，支持各种屏幕尺寸