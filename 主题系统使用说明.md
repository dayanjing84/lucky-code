# 海报主题系统使用说明

## 概述

海报主题系统已成功集成到项目中！现在海报会根据以下因素自动更换样式：

- **时间段**：早晨、午间、傍晚、夜晚
- **天气状况**：晴天、雨天、雪天等
- **重要节假日**：春节、国庆、中秋等传统节日

## 主题优先级

系统会按照以下优先级选择主题（从高到低）：

1. **重要节日主题** - 如果是节假日，优先使用节日主题
2. **天气主题** - 根据当前天气选择对应主题
3. **时间段主题** - 根据生成时间选择早晨/午间/傍晚/夜晚主题
4. **默认主题** - 经典蓝调主题

## 内置主题列表

### 时间段主题

| 主题名称 | 时间范围 | 特点 |
|---------|---------|------|
| 早晨清新 | 05:00-09:00 | 温暖的橙黄色调，充满朝气 |
| 午间活力 | 09:00-18:00 | 明亮的橙红色调，活力四射 |
| 傍晚温暖 | 18:00-21:00 | 温暖的橙色调，舒适惬意 |
| 夜晚神秘 | 21:00-05:00 | 深邃的蓝紫色调，宁静神秘 |

### 天气主题

| 主题名称 | 触发条件 | 特点 |
|---------|---------|------|
| 晴天明亮 | 晴天 | 明亮的黄色调，阳光灿烂 |
| 雨天温馨 | 小雨/中雨/大雨/雷阵雨 | 清新的蓝色调，温馨浪漫 |
| 雪天浪漫 | 下雪 | 纯净的银灰色调，浪漫诗意 |

### 节日主题

| 主题名称 | 节日 | 特点 |
|---------|------|------|
| 春节喜庆 | 春节/除夕 | 红色+金色，喜庆热闹 |
| 情人节浪漫 | 情人节 | 粉红色调，浪漫温馨 |
| 清明素雅 | 清明节 | 灰蓝色调，素雅庄重 |
| 劳动节活力 | 劳动节 | 橙黄色调，充满活力 |
| 端午传统 | 端午节 | 绿色调，传统自然 |
| 中秋团圆 | 中秋节 | 橙黄色调，温馨团圆 |
| 国庆爱国 | 国庆节 | 红色+金色，爱国热情 |
| 元旦新年 | 元旦 | 紫色调，新年气氛 |

## 配置天气API（可选）

系统支持接入高德天气API以获取实时天气信息：

### 1. 获取高德API Key（免费）

1. 访问 [高德开放平台](https://lbs.amap.com/)
2. 注册并创建应用
3. 获取Web服务API Key

### 2. 配置环境变量

在项目根目录创建 `.env` 文件或设置环境变量：

```bash
# Windows 命令行
set AMAP_WEATHER_KEY=你的高德API_KEY

# Windows PowerShell
$env:AMAP_WEATHER_KEY="你的高德API_KEY"

# Linux/Mac
export AMAP_WEATHER_KEY=你的高德API_KEY
```

### 3. 未配置API的情况

如果没有配置天气API，系统会：
- 默认使用"晴天"天气
- 仍然会根据时间段和节日自动选择主题
- 不影响正常使用

## 使用方法

### 命令行使用

主题系统已自动集成，无需额外配置：

```bash
# 生成一张海报（自动应用主题）
python main.py --once

# 指定分类生成
python main.py --once --category "尾号双重"

# 调试模式查看主题信息
python main.py --once --debug
```

### Web界面使用

启动Web界面后，主题系统会自动工作：

```bash
# 启动Web服务器
python web_app.py

# 或使用批处理文件
start_web.bat
```

访问 `http://127.0.0.1:5000`，点击"生成海报"即可。

## 主题效果示例

生成海报时，控制台会显示主题信息：

```
[INFO] 生成时间: 2025-10-20T14:30:00+08:00 时段: noon
[INFO] 使用 Excel: C:\Users\13507\Desktop\luck\吉祥号码.xlsx
[INFO] 选择分类: 尾号双重
[INFO] 今日节日: 国庆节
[INFO] 当前天气: 晴天
[INFO] 使用主题: 国庆爱国
[OK] 已生成: output/20251020_1430.jpg
```

## 主题系统文件结构

```
app/
├── theme_system.py      # 主题配色和选择逻辑
├── weather_api.py       # 天气API集成
├── holidays_util.py     # 节日检测（已有）
└── poster_generator_v2.py  # 海报渲染引擎（已更新）
```

## 自定义主题

如需自定义主题，编辑 `app/theme_system.py`：

```python
# 添加新主题到 THEMES 字典
THEMES["我的主题"] = ThemeColors(
    name="我的主题",
    bg_top=(R, G, B),           # 背景顶部颜色
    bg_bottom=(R, G, B),        # 背景底部颜色
    header_top=(R, G, B),       # 头部顶部颜色
    header_bottom=(R, G, B),    # 头部底部颜色
    footer_top=(R, G, B),       # 底部顶部颜色
    footer_bottom=(R, G, B),    # 底部底部颜色
    title_color=(R, G, B),      # 标题颜色
    subtitle_color=(R, G, B),   # 副标题颜色
    tagline_color=(R, G, B),    # 标语颜色
    card_fill=(R, G, B),        # 卡片填充颜色
    card_border=(R, G, B),      # 卡片边框颜色
)
```

## 常见问题

### Q: 为什么天气总是显示"晴天"？
A: 需要配置高德天气API Key，参见上方"配置天气API"章节。

### Q: 如何禁用某个主题？
A: 编辑 `app/theme_system.py` 中的 `select_theme()` 函数，修改选择逻辑。

### Q: 节日识别不准确？
A: 节日检测使用 `holidays` 库，可在 `app/holidays_util.py` 中查看或扩展。

### Q: 能否手动指定主题？
A: 可以修改 `main.py` 中的 `generate_once()` 函数，直接传入特定主题：
```python
from app.theme_system import THEMES
theme = THEMES["春节喜庆"]
```

## 技术说明

- **渐变背景**：所有主题使用垂直渐变，从顶部颜色过渡到底部颜色
- **动态适配**：文字颜色根据背景自动调整，确保可读性
- **无图片依赖**：完全使用程序化绘制，无需外部图片素材
- **向后兼容**：未配置主题时自动使用默认蓝调主题

## 更新日志

### v2.0 (2025-10-20)
- ✨ 新增主题系统，支持时间段/天气/节日自动切换
- ✨ 新增天气API集成（高德天气）
- ✨ 新增14种预设主题
- 🎨 优化配色方案，更加美观
- 📝 完善文档说明

---

如有问题或建议，请在项目中反馈！
